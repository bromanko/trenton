#######################################################
# Variables
#######################################################

COLOR_BLACK="\033[30m"
COLOR_RED="\033[31m"
COLOR_GREEN="\033[32m"
COLOR_YELLOW="\033[33m"
COLOR_BLUE="\033[34m"
COLOR_MAGENTA="\033[35m"
COLOR_CYAN="\033[36m"
COLOR_LIGHT_GRAY="\033[37m"
COLOR_DARK_GRAY="\033[38m"
COLOR_NORMAL="\033[39m"

DOCKER_REGISTRY=gcr.io
DOCKER_NAMESPACE=alpine-images
COMMON_DOCKER_IMAGE_BASE=${DOCKER_REGISTRY}/${DOCKER_NAMESPACE}

CI_COMMIT_SHA=${GITHUB_SHA:-}
if [[ -z ${CI_COMMIT_SHA} ]]; then
  COMMON_COMMIT_SHA=$(git rev-parse HEAD)
else
  COMMON_COMMIT_SHA=${CI_COMMIT_SHA}
fi

DOCKER_COMPOSE_NETWORK=trenton

#######################################################
# Functions
#######################################################

function info() {
  echo -e "$COLOR_NORMAL$*$COLOR_NORMAL"
}

function warn() {
  >&2 echo -e "$COLOR_YELLOW$*$COLOR_NORMAL"
}

function error() {
  >&2 echo -e "$COLOR_RED$*$COLOR_NORMAL" >&2
}

function ensureNetwork() {
  set +e
  docker network inspect "$DOCKER_COMPOSE_NETWORK" >/dev/null 2>&1
  if [[ $? != 0 ]]; then
    warn "Creating shared Docker network."
    docker network create "$DOCKER_COMPOSE_NETWORK" >/dev/null 2>&1
  fi
  set -e
}

function gcloudProjectForEnv() {
  declare -A projects
  projects=(
    [production]="development-a0ec991abee20869"
  )
  environment=$1
  if [[ -z ${projects[$environment]+x} ]]; then
    warn "Environment specified does not exist"
    exit 1
  fi
  echo "${projects[$environment]}"
}

#######################################################
# Initialization
#######################################################

ensureNetwork
